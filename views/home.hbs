<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{titulo}}</title>
  <link rel="stylesheet" href="/css/styles.css">
  <script defer src="/js/main.js?v=2"></script>
</head>
<body>
  <header class="topbar">
    <h1>ENCONTRO DA TURMA PRODIGI - Turma 2025/2026</h1>
    <nav>
      <a href="/">In√≠cio</a>
      <a href="/onde-quando">Onde & Quando</a>
      <a href="/menus">Menus & Pre√ßos</a>
      <a href="/inscricao">Inscri√ß√£o</a>
      <a href="/lista">Lista de Inscritos</a>
      <a href="/galeria">Galeria</a>
      <a href="/contacto">Contactos</a>
      <a href="/alojamento">Alojamento</a>
    </nav>
  </header>

  <main class="hero">
    <div class="evento-container">
      <div class="evento-texto">
        <h2>Almo√ßo da Turma PRODIGI 2025</h2>

        <p><strong>Data:</strong> S√°bado, 21 de Fevereiro de 2026, 13h00</p>
        <p><strong>Local:</strong> Restaurante Os Severianos - Campelos</p>

        <p><strong>Faltam:</strong></p>
        <p id="contador-texto"></p>

        <a href="/inscricao" class="btn-inscricao">Fazer Inscri√ß√£o</a>
      </div>

      <div class="evento-imagens">
        <img src="/img/Faculdades.png" class="img-principal" alt="IST - T√©cnico Lisboa" />
      </div>
    </div>
  </main>

  <script>
    // Data do evento vinda do servidor (ex: 2026-02-21T13:00:00)
    const eventoStr = "{{dataEvento}}";

    // Converte "YYYY-MM-DDTHH:mm:ss" para timestamp, assumindo Europe/Lisbon
    // (evita erros de fuso hor√°rio / hor√°rio de ver√£o)
    function toLisbonTimestamp(isoLocal) {
      const [datePart, timePart] = isoLocal.split("T");
      const [y, m, d] = datePart.split("-").map(Number);
      const [hh, mm, ss] = timePart.split(":").map(Number);

      // "palpite" UTC com os mesmos valores
      const utcGuess = new Date(Date.UTC(y, m - 1, d, hh, mm, ss || 0));

      // transforma esse instante em componentes, mas vistos em Europe/Lisbon
      const parts = new Intl.DateTimeFormat("en-US", {
        timeZone: "Europe/Lisbon",
        hour12: false,
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      }).formatToParts(utcGuess);

      const get = (type) => parts.find(p => p.type === type).value;

      const lisbonAsIfUTC = Date.UTC(
        Number(get("year")),
        Number(get("month")) - 1,
        Number(get("day")),
        Number(get("hour")),
        Number(get("minute")),
        Number(get("second"))
      );

      const offsetMs = lisbonAsIfUTC - utcGuess.getTime();
      return utcGuess.getTime() - offsetMs;
    }

    const eventoTs = toLisbonTimestamp(eventoStr);

    function atualizarContador() {
      const el = document.getElementById("contador-texto");
      if (!el) return;

      const agora = Date.now();
      let diff = eventoTs - agora;

      if (diff <= 0) {
        el.textContent = "√â hoje! üéâ";
        return;
      }

      // calcula por minutos para evitar ‚Äúsaltos‚Äù estranhos
      const totalMin = Math.floor(diff / 60000);
      const dias = Math.floor(totalMin / (60 * 24));
      const horas = Math.floor((totalMin % (60 * 24)) / 60);
      const minutos = totalMin % 60;

      el.textContent = `${dias} dia(s), ${horas} hora(s) e ${minutos} minuto(s)`;
    }

    atualizarContador();
    setInterval(atualizarContador, 30000); // a cada 30s
  </script>
</body>
</html>